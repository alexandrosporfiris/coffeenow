var currentUrl = window.location.href;

// fix language redirect url, which cannot work correctly because of base meta tag
function languageUri(param){
	
	// remove any query params
	if ( currentUrl.indexOf("?") ) {
		let urlParts = currentUrl.split("?");
		currentUrl = urlParts[0];
	}
	
	// check for slash at the end and remove it
	if (currentUrl.charAt(currentUrl.length - 1) == "/") 
		currentUrl = currentUrl.substr(0, currentUrl.length - 1);
	
	// add clicked link href to final url
	currentUrl = currentUrl + param;
	
	window.location = currentUrl;
	
}

// function to ask user yes or no for a destructive action
function yesNo(elem, container, url){
	$(elem).parent().addClass("hiddenCFN");
	$(elem).closest(container).append('<form class="yesNoFormCFN" action="'+url+'">'+language_JSON[locale]["areYouSure"]+'<button class="btn btn-success btn-sm yes"><span class="text-white-50">'+language_JSON[locale]["yes"]+'</span></button><button class="btn btn-danger btn-sm no"><span class="text-white-50">'+language_JSON[locale]["no"]+'</span></button></form>');
}

$(document).ready(function() {
	
	// handling yes click of a yesNoFormCFN, generated by function yesNo
	$(document).on("click", ".yesNoFormCFN .yes", function(e){
		$(".yesNoFormCFN").submit();
	});
	
	// handling no click of a yesNoFormCFN, generated by function yesNo
	$(document).on("click", ".yesNoFormCFN .no", function(e){
		$(".yesNoFormCFN").parent().find(".hiddenCFN").removeClass("hiddenCFN");
		$(".yesNoFormCFN").remove();
	});
	
	// productcategories DATATABLE
	var table = $('#dataTable').DataTable({
		select: {
			style: 'single',
			selector: 'td:not(:last-child)'
		},
		info: false
	});
	
	// ON DATATABLE ROW SELECT
	table.on( 'select', function( event, data, type, indexes ) {
		event.preventDefault;
		let selectedRow = table[ type ]( indexes ).nodes().to$();
		selectedRow.find(".optionsCFN").html('<form><button type="button" onclick="yesNo(this, \'.optionsCFN\', \'administrator/dashboard/productcategories/delete/'+ selectedRow.find(".rowIdCFN").html() +'\')" class="btn btn-danger btn-sm"><span class="icon text-white-50"><i class="fas fa-trash"></i></span></button></form>');
	});
	
	// ON DATATABLE ROW DESELECT
	table.on( 'deselect', function( event, data, type, indexes ) {
		event.preventDefault;
		table[ type ]( indexes ).nodes().to$().children().last().html('');
	});
	
});
